<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.innovative.dao.ProjectApprovalDao">
	<resultMap type="ProjectApproval" id="ProjectApproval">
		<id property="id" column="id"/>
		<result property="proname" column="proname"/>
		<result property="pronum" column="pronum"/>
		<result property="eoms" column="eoms"/>
		<result property="demander" column="demander"/>
		<result property="contact" column="contact"/>
		<result property="demand_bg" column="demand_bg"/>
		<result property="demand_core" column="demand_core"/>
		<result property="demand_count" column="demand_count"/>
		<result property="keyword" column="keyword"/>
		<result property="coopmodel" column="coopmodel"/>
		<result property="require" column="require"/>
		<result property="cost" column="cost"/>
		<result property="completion" column="completion"/>
		<result property="remark" column="remark"/>
		<result property="create_date" column="create_date"/>
		<result property="create_by" column="create_by"/>
		<result property="late_date" column="late_date"/>
		<result property="late_by" column="late_by"/>
		<result property="status" column="status"/>
	</resultMap>
	<!-- 添加立项表单 -->
	<insert id="addProjectApproval" parameterType="ProjectApproval">
		<selectKey keyProperty="id"  order="AFTER" resultType="int">
			SELECT currval('xacx_project_approval_id_seq'::regclass)
		</selectKey>
		INSERT INTO xacx_project_approval(proname,pronum,eoms,demander,contact,demand_bg,demand_core,
		demand_count,keyword,coopmodel,require,cost,completion,remark,create_date,create_by,status) 
		VALUES(#{proname},#{pronum},#{eoms},#{demander},#{contact},#{demand_bg},#{demand_core},
		#{demand_count},#{keyword},#{coopmodel},#{require},#{cost},#{completion},#{remark},current_date,#{create_by},0)
	</insert>
		
	<!-- 通过订单id查询立项表单 -->
	<select id="getProjectApprovalById" parameterType="int" resultMap="ProjectApproval">
		SELECT id,proname,pronum,eoms,demander,contact,demand_bg,demand_core,demand_count,keyword,coopmodel,
		require,cost,completion,remark,create_date,create_by,late_date,late_by,status FROM xacx_project_approval 
		WHERE id = (SELECT approvalid FROM xacx_order WHERE id = #{order_id})
	</select>
	<!-- 通过id查询立项表单的状态  0是未接单，1是已接单 -->
	<select id="getProjectApprovalStatusById" parameterType="int" resultType="int">
		SELECT status FROM xacx_project_approval WHERE id = #{id}
	</select>
	
	
	
	
	<!-- 查询所有的立项表单 -->
	<select id="getProjectApprovals" resultMap="ProjectApproval">
		SELECT id,proname,pronum,eoms,demander,contact,demand_bg,demand_core,demand_count,keyword,coopmodel,
		require,cost,completion,remark,create_date,create_by,late_date,late_by,status FROM xacx_project_approval 
		ORDER BY status desc , create_date desc
	</select>
	
	<!-- 通过立项表单的id更改的立项表单的状态 -->
	<update id="updateProjectApprovalStatus" parameterType="int">
		UPDATE xacx_project_approval SET status = 1 WHERE id = #{id}
	</update>
</mapper>